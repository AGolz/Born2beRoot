text

%pre

exec < /dev/tty > /dev/tty 2> /dev/tty

while true; do

  echo -n "Enter LUKS encryption key: "
  stty -echo  
  read encryption_key
  stty echo   

  echo -n "$encryption_key" | cryptsetup open --type luks --passphrase-fd 0 /dev/sda5 sda5_crypt && break

  echo "Incorrect key. Try again."
done
%end
