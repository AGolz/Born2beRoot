%pre
iotty="$(tty)"
exec > "${iotty}" 2> "${iotty}"

while true; do
  read -s -p "Enter LUKS encryption key: " encryption_key
  echo 
  echo "$encryption_key" | cryptsetup open --type luks --passphrase-fd 0 /dev/sda5 sda5_crypt && break
  echo "Incorrect key. Try again."
done
%end
